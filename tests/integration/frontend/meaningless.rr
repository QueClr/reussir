// RUN: %reussir-elab --mode semi %s | %FileCheck %s
enum Foo {
    Bar(Foo),
    Baz,
    Qux(Foo, Foo)
}

fn foo(x : Foo, flag: bool) -> Foo {
    match x {
        Foo::Qux(y, Foo::Qux(_, _)) => y,
        _ if flag => x,
        Foo::Qux(_, Foo::Bar(z)) => z,
        Foo::Qux(y, Foo::Baz) => y,
        Foo::Bar(y) => foo(y, flag),
        Foo::Baz => Foo::Baz{}
    }
}
// CHECK:      ;; Instantiated Generics
// CHECK:      ;; Elaborated Records
// CHECK-NEXT: enum_variant [value] Foo::Baz()
// CHECK:      enum_variant [value] Foo::Bar(Foo)
// CHECK:      enum [shared] Foo{
// CHECK-NEXT:     Bar,
// CHECK-NEXT:     Baz,
// CHECK-NEXT:     Qux
// CHECK-NEXT: }
// CHECK:      enum_variant [value] Foo::Qux(Foo, Foo)
// CHECK:      ;; Elaborated Functions
// CHECK-NEXT: fn foo(v0 (x): Foo, v1 (flag): bool) -> Foo {
// CHECK-NEXT:     match v0 {
// CHECK-NEXT:         switch (0) {
// CHECK-NEXT:             ctor@0 => {
// CHECK-NEXT:                 if v1 {
// CHECK-NEXT:                     v0
// CHECK-NEXT:                 }
// CHECK-NEXT:                 otherwise {
// CHECK-NEXT:                     pattern var v2 (0, 0)
// CHECK-NEXT:                     foo(v2, v1) : Foo
// CHECK-NEXT:                 }
// CHECK-NEXT:             }
// CHECK-NEXT:             ctor@1 => {
// CHECK-NEXT:                 if v1 {
// CHECK-NEXT:                     v0
// CHECK-NEXT:                 }
// CHECK-NEXT:                 otherwise {
// CHECK-NEXT:                     Foo[1](Foo::Baz() : Foo::Baz) : Foo
// CHECK-NEXT:                 }
// CHECK-NEXT:             }
// CHECK-NEXT:             ctor@2 => {
// CHECK-NEXT:                 switch (0, 1) {
// CHECK-NEXT:                     ctor@0 => {
// CHECK-NEXT:                         if v1 {
// CHECK-NEXT:                             v0
// CHECK-NEXT:                         }
// CHECK-NEXT:                         otherwise {
// CHECK-NEXT:                             pattern var v2 (0, 1, 0)
// CHECK-NEXT:                             v2
// CHECK-NEXT:                         }
// CHECK-NEXT:                     }
// CHECK-NEXT:                     ctor@1 => {
// CHECK-NEXT:                         if v1 {
// CHECK-NEXT:                             v0
// CHECK-NEXT:                         }
// CHECK-NEXT:                         otherwise {
// CHECK-NEXT:                             pattern var v2 (0, 0)
// CHECK-NEXT:                             v2
// CHECK-NEXT:                         }
// CHECK-NEXT:                     }
// CHECK-NEXT:                     ctor@2 => {
// CHECK-NEXT:                         pattern var v2 (0, 0)
// CHECK-NEXT:                         v2
// CHECK-NEXT:                     }
// CHECK-NEXT:                 }
// CHECK-NEXT:             }
// CHECK-NEXT:         }
// CHECK-NEXT:     }
// CHECK-NEXT: }
